{% assign collection = collections[section.settings.collection] %}
{% assign limit = section.settings.rows | times: section.settings.per_row %}
{% if section.settings.show_as_slider == true %}
{% assign limit = collection.products.size %}
{% if limit < section.settings.per_row or limit == blank %}
{% assign limit = 3 %}
{% endif %}
{% endif %}

{% case section.settings.per_row %}
  {% when 2 %}
    {% assign grid_class = 'desk--one-half' %}
  {% when 3 %}
    {% assign grid_class = 'desk--one-third' %}
  {% when 4 %}
    {% assign grid_class = 'desk--one-quarter' %}
  {% else %}
    {% assign grid_class = 'desk--one-fifth' %}
{% endcase %}

<section data-section-id="{{section.id}}" data-type="collection"{% if section.settings.section_width == 'full-width' %} class="full-width"{% endif %}{% if section.settings.show_as_slider == true and collection.products.size > section.settings.per_row %} show-slideshow{% endif %}>

  {% if section.settings.title != blank %}
  <h3 class="general-title" data-theme-editor-setting="title">{{section.settings.title}}</h3>
  {% endif %}

  <div class="grid product-container{% if section.settings.show_as_slider == true and collection.products.size > section.settings.per_row %} collection-slideshow{% endif %}" data-arrow-image="{{'images/icons.svg' | asset_url}}" data-show-count="{{section.settings.per_row}}">
    {% if collection.products.size != blank or !collection %}
    {% for product in collection.products limit: limit %}
    {% include 'list_product' %}
    {% endfor %}
    {% else %}

    {% comment %} default view for builder {% endcomment %}

    {% for product in (1..limit) %}
    {% unless forloop.first %}-->{% endunless %}<div class="grid__item one-whole lap--one-half {{grid_class}}">
      <div class="product fake-link">
        <div class="image"></div>

        <h2 class="product-title general-title">{{'section.default.product_name' | t}}</h2>

        <div class="product-price">
          <span class="money">{{'14.95' | money}}</span>
        </div>
      </div>
    </div>{% unless forloop.last %}<!--{% endunless %}
    {% endfor %}
    {% endif %}
  </div>

  {% if section.settings.show_button == true %}
  <div class="buttons">
    <a href="{{collection.url}}" role="button" class="button secondary">{{'section.default.view_all' | t}}</a>
  </div>
  {% endif %}

  <script>
    $(document).ready(function() {
      $("[data-section-id='{{section.id}}'] .collection-slideshow").each(function() {
        $(this).slick({
          prevArrow: '<div class="slick-prev"><svg class="icon-arrow-back"><use xlink:href="' + $(this).data('arrow-image') + '#icon-arrow"></use></svg></div>',
          nextArrow: '<div class="slick-next"><svg class="icon-arrow-next"><use xlink:href="' + $(this).data('arrow-image') + '#icon-arrow"></use></svg></div>',
          slidesToShow: $(this).data('show-count'),
          slidesToScroll: $(this).data('show-count'),
          lazyLoad: 'ondemand',
          responsive: [
            {
              breakpoint: 1023,
              settings: {
                slidesToShow: 2,
                slidesToScroll: 2
              }
            },
            {
              breakpoint: 480,
              settings: {
                slidesToShow: 1,
                slidesToScroll: 1
              }
            }
          ]
        });
      });
    });
  </script>

</section>
